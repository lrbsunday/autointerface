{% macro define_model_field(rule, model_name) %}
    {# 类型 #}
    {% set field_type = rule['type'] | format_model_type %}
    {# 默认值 #}
    {% set arg_list = [] %}
    {% for key, value in rule.items() %}
        {% if key == 'model' %}
            {% do arg_list.append(value | capitalize) %}
        {% endif %}
    {% endfor %}
    {% for key, value in rule.items() %}
        {% if key == 'model' %}
            {% continue %}
        {% endif %}
        {% if key == 'on_delete' %}
            {% do arg_list.append('on_delete=' ~ value | format_value) %}
        {% endif %}
        {% if key == 'default' %}
            {% do arg_list.append('default=' ~ value | format_value) %}
        {% endif %}
        {% if key == 'null' %}
            {% do arg_list.append('null=' ~ value | format_value) %}
        {% endif %}
        {% if key == 'index' %}
            {% do arg_list.append('index=' ~ value | format_value) %}
        {% endif %}
        {% if key == 'unique' %}
            {% do arg_list.append('unique=' ~ value | format_value) %}
        {% endif %}
        {% if key == 'description' %}
            {% do arg_list.append('help_text=' ~ value | format_value) %}
        {% endif %}
    {% endfor %}
    {% if rule['type'] == 'foreign' %}
        {% do arg_list.append('backref="' ~ model_name ~ '"') %}
    {% endif %}
    {# 代码 #}
    {{ rule['name'] }} = {{ field_type }}({{ arg_list | join(', ') }})
{% endmacro %}

from peewee import *
from . import *
{% for require in requires %}
from {{ project_name }}.models.{{ require }} import {{ require | capitalize }}
{% endfor %}


class {{ name | capitalize }}(MyModel):
    {% for rule in rules %}
        {{- define_model_field(rule, name) -}}
    {% endfor %}